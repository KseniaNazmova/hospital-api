# hospital-api
Тестовое задание для ООО Медицинские Информационные Решения
+ [Задание для разработчика](#Task);
+ [Разворачиваем проект на локальной машине](#Instruction);

```
# <a name="Task"></a> Задание для разработчика:

Имеется две основные модели: врач и пациент
Задача:
1) Реализовать метод API создания пациента с валидацией всех полей.
2) Реализовать метод API создания врача с валидацией всех полей.
3) Реализовать метод API записи пациента к врачу. Запись осуществляется на определенную дату и время. Время приема -  30 минут. Записи не должны пересекаться  по времени и выходить за рамки рабочего дня врача.
4) Реализовать метод API получения списка записей к врачу с фильтрацией по полям: ФИО врача, ФИО пациента и интервалу дат записи. Добавить сортировку по дате и времени записи на прием. Также необходимо реализовать пагинацию  - 10 записей на странице.

Описание моделей:
1) Врач
обязательные поля:
- Фамилия
- Имя
- Телефон
- Время начала рабочего дня
- Время окончания рабочего дня
Необязательные поля:
- Дата рождения
- Отчество
- email

2) Пациент
Обязательно заполнение хотя бы одного из полей:
- Фамилия
- Имя
- Отчество
Обязательное поле
- СНИЛС
Необязательные поля:
- Дата рождения
- Место жительства

В качестве БД использовать PostgreSQL.  Фреймворк laravel версии 8.
Для backend разработчика необходимо покрыть все API unit тестами. Тесты должны создать как минимум 30 записей к врачу.  
Fullstack разработчик может заменить unit тесты на формы реализующие функционал описанных API. Реализация допускается только на VueJS 2 

При проверке задания особое внимание будет уделяться валидации реквестов, аккуратности кода, корректной работе API и написанию тестов.
```

# <a name="Instruction"></a> Разворачиваем проект на локальной машине.

В данной инструкции мы рассмотрим шаги, необходимые для развертывания Laravel приложения в Docker контейнерах.

## Шаг 1: Установка Docker и Docker Compose

Перед началом работы необходимо установить Docker и Docker Compose. Убедитесь, что у вас установлены последние версии этих инструментов.

## Шаг 2: Конфигурация проекта

Для того, чтобы наше приложение успешно запускалось в Docker, необходимо выполнить следующие шаги:

1. Скопируйте .env.example в .env в ту же директорию. При необходимости измените дефолтные настройки проекта.

2. Запустите файл `docker-compose.yml` в корневой директории проекта командой
```
docker compose up -d
```

3. Войдите в контейнер командой, установите зависимости композера и примените миграции
```
docker exec -it hospital-php bash
composer install
php artisan doctrine:migrations:migrate
```

## Шаг 3: Api готов к работе.

Выполнить запросы можно через .http-файлы в директории `api`.

Список доступных методов API:

1. метод API создания пациента `/api/patients/create`
```
Спецификация входящих параметров
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "firstName": {
      "type": "string",
      "maxLength": 255
    },
    "lastName": {
      "type": "string",
      "maxLength": 255
    },
    "middleName": {
      "type": "string",
      "maxLength": 255
    },
    "snils": {
      "type": "string",
      "maxLength": 255
    },
    "residence": {
      "type": "string",
      "maxLength": 255
    },
    "birthDate": {
      "type": "string",
      "format": "date-time"
    }
  },
  "oneOf": [
    {
      "required": ["firstName"]
    },
    {
      "required": ["lastName"]
    },
    {
      "required": ["middleName"]
    }
  ],
  "required": ["snils"]
}

Пояснения:
firstName - необязательное строковое поле с максимальной длиной 255 символов, содержащее имя пациента. Должно быть указано, если отсутствует lastName и middleName.
lastName - необязательное строковое поле с максимальной длиной 255 символов, содержащее фамилию пациента. Должно быть указано, если отсутствует firstName и middleName.
middleName - необязательное строковое поле с максимальной длиной 255 символов, содержащее отчество пациента. Должно быть указано, если отсутствует firstName и lastName.
snils - обязательное строковое поле с максимальной длиной 255 символов, содержащее СНИЛС пациента.
residence - необязательное строковое поле с максимальной длиной 255 символов, содержащее место жительства пациента.
birthDate - необязательное строковое поле, содержащее дату рождения пациента. Должно соответствовать формату DATE_ATOM (например, 2022-05-06T10:30:00+00:00).
```

2. метод API создания врача `/api/doctor/create`
```
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "firstName": {
      "type": "string",
      "maxLength": 255
    },
    "middleName": {
      "type": "string",
      "maxLength": 255
    },
    "lastName": {
      "type": "string",
      "maxLength": 255
    },
    "phone": {
      "type": "string",
      "maxLength": 255
    },
    "workdayStart": {
      "type": "string",
      "pattern": "^([01][0-9]|2[0-3]):[0-5][0-9]$"
    },
    "workdayEnd": {
      "type": "string",
      "pattern": "^([01][0-9]|2[0-3]):[0-5][0-9]$"
    },
    "birthDate": {
      "type": "string",
      "format": "date-time"
    },
    "email": {
      "type": "string",
      "maxLength": 255,
      "format": "email"
    }
  },
  "required": ["firstName", "lastName", "phone", "workdayStart", "workdayEnd", "email"]
}

Пояснения:
firstName - обязательное строковое поле с максимальной длиной 255 символов, содержащее имя сотрудника.
middleName - необязательное строковое поле с максимальной длиной 255 символов, содержащее отчество сотрудника.
lastName - обязательное строковое поле с максимальной длиной 255 символов, содержащее фамилию сотрудника.
phone - обязательное строковое поле с максимальной длиной 255 символов, содержащее номер телефона сотрудника.
workdayStart - обязательное строковое поле, содержащее время начала рабочего дня сотрудника. Должно соответствовать формату H:i (например, 09:00).
workdayEnd - обязательное строковое поле, содержащее время окончания рабочего дня сотрудника. Должно соответствовать формату H:i (например, 17:00).
birthDate - необязательное строковое поле, содержащее дату рождения сотрудника. Должно соответствовать формату DATE_ATOM (например, 2022-05-06T10:30:00+00:00).
email - обязательное строковое поле с максимальной длиной 255 символов, содержащее электронный адрес сотрудника. Должно соответствовать формату email.
```

1. метод API создания записи пациента к врачу `/api/appointment/create`
```
Спецификация входящих параметров
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "doctorId": {
      "type": "string",
      "format": "uuid"
    },
    "patientId": {
      "type": "string",
      "format": "uuid"
    },
    "startAt": {
      "type": "string",
      "format": "date-time"
    }
  },
  "required": ["doctorId", "patientId", "startAt"]
}

Пояснения:
doctorId - обязательное строковое поле, содержащее UUID идентификатор врача.
patientId - обязательное строковое поле, содержащее UUID идентификатор пациента.
startAt - обязательное строковое поле, содержащее дату и время начала приема. Должно соответствовать формату DATE_ATOM (например, 2022-05-06T10:30:00+00:00).
```

4. метод API получения списка записей к врачу `/api/appointment/list`
```
Спецификация входящих параметров
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "doctorFullName": {
      "type": "string",
      "maxLength": 767
    },
    "patientFullName": {
      "type": "string",
      "maxLength": 767
    },
    "startDate": {
      "type": "string",
      "format": "date"
    },
    "endDate": {
      "type": "string",
      "format": "date",
      "formatMinimum": {
        "$data": "1/startDate"
      }
    },
    "sortDirection": {
      "type": "string",
      "enum": ["asc", "desc"]
    },
    "page": {
      "type": "integer",
      "minimum": 1
    },
    "perPage": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100
    }
  }
}

Пояснения:
doctorFullName - необязательное строковое поле с максимальной длиной 767 символов, содержащее полное имя врача.
patientFullName - необязательное строковое поле с максимальной длиной 767 символов, содержащее полное имя пациента.
startDate - необязательное строковое поле, содержащее дату начала периода, который нужно выбрать.
endDate - необязательное строковое поле, содержащее дату окончания периода, который нужно выбрать. Должно быть больше или равно полю startDate.
sortDirection - необязательное строковое поле, содержащее направление сортировки результатов выборки. Может быть равно asc или desc.
page - необязательное целочисленное поле, содержащее номер страницы, которую нужно выбрать. Должно быть больше или равно 1.
perPage - необязательное целочисленное поле, содержащее количество элементов на странице. Должно быть от 1 до 100.
```
